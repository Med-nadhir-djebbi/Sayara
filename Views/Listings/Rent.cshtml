@{
    ViewData["Title"] = "Luxury Car Rentals";
}

<div class="container py-5 animate-fade-in">
    <!-- Premium Header -->
    <div class="row align-items-center mb-5 reveal">
        <div class="col-lg-8">
            <h1 class="display-3 font-weight-bold mb-3">Elite <span class="text-success">Rentals</span></h1>
            <p class="text-muted lead mb-0">Discover the pinnacle of automotive luxury. Exclusive models, meticulously maintained, ready for your next journey.</p>
        </div>
        <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
            <div class="d-inline-flex align-items-center p-3 bg-light rounded-pill px-4 border">
                <i class="fas fa-shield-alt text-success me-3 fs-4"></i>
                <div class="text-start">
                    <div class="fw-bold text-dark" style="font-size: 0.9rem;">Verified Fleet</div>
                    <div class="text-muted" style="font-size: 0.75rem;">100% Quality Inspected</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-5">
        <!-- Main Content Area (Left, 3/4 width) -->
        <div class="col-lg-9 order-lg-1">
            <div class="listings-grid-three" id="rentListings">
                <!-- Skeleton Loaders -->
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>
        </div>

        <!-- Right Sidebar Filters (Right, 1/4 width) -->
        <div class="col-lg-3 order-lg-2">
            <div class="sidebar-filters reveal">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="font-weight-bold mb-0">Refine Selection</h5>
                    <i class="fas fa-sliders-h text-muted"></i>
                </div>
                
                <form id="filterForm" class="d-flex flex-column gap-4">
                    <!-- Vehicle Details -->
                    <div class="filter-section">
                        <h6 class="filter-section-title">Vehicle Info</h6>
                        <div class="filter-group">
                            <label class="filter-label">Brand</label>
                            <div class="input-with-icon">
                                <i class="fas fa-car icon-green"></i>
                                <input type="text" name="Brand" placeholder="e.g. Mercedes" class="filter-input input-green">
                            </div>
                        </div>
                        <div class="filter-group mt-3">
                            <label class="filter-label">Model</label>
                            <div class="input-with-icon">
                                <i class="fas fa-tag icon-green"></i>
                                <input type="text" name="Model" placeholder="e.g. S-Class" class="filter-input input-green">
                            </div>
                        </div>
                    </div>

                    <!-- Pricing -->
                    <div class="filter-section mt-2">
                        <h6 class="filter-section-title">Pricing & Rates</h6>
                        <div class="filter-group">
                            <label class="filter-label">Daily Rate ($)</label>
                            <div class="dual-inputs">
                                <input type="number" name="MinDailyRate" placeholder="Min" class="filter-input no-icon control-green">
                                <input type="number" name="MaxDailyRate" placeholder="Max" class="filter-input no-icon control-green">
                            </div>
                        </div>
                    </div>

                    <!-- Specifications -->
                    <div class="filter-section mt-2">
                        <h6 class="filter-section-title">Specifications</h6>
                        <div class="filter-group">
                            <label class="filter-label">Engine & Transmission</label>
                            <select name="EngineType" class="filter-input no-icon control-green mb-2">
                                <option value="">Any Engine</option>
                                <option value="0">Petrol</option>
                                <option value="1">Diesel</option>
                                <option value="2">Electric</option>
                                <option value="3">Hybrid</option>
                            </select>
                            <select name="TransmissionType" class="filter-input no-icon control-green">
                                <option value="">Any Transmission</option>
                                <option value="0">Manual</option>
                                <option value="1">Automatic</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-action-group pt-4">
                        <button type="submit" class="btn btn-success-premium w-100 mb-3 py-3 shadow-sm">
                            <i class="fas fa-search me-2"></i> Find My Rental
                        </button>
                        <button type="reset" class="btn-reset w-100 py-2" onclick="setTimeout(() => loadListings(), 10)">
                            Reset All Filters
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .filter-section-title {
        font-size: 0.75rem;
        font-weight: 800;
        color: var(--text-dark);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 2px solid #f1f5f9;
    }

    .sidebar-filters {
        background: white;
        border: 1px solid #e2e8f0;
        padding: 25px;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        position: sticky;
        top: 110px;
    }

    .filter-group { display: flex; flex-direction: column; gap: 8px; }
    .filter-label { 
        font-size: 0.75rem; 
        font-weight: 700; 
        color: #64748b; 
    }

    .input-with-icon { position: relative; }
    .icon-green { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--primary-green); font-size: 0.85rem; }
    
    .filter-input {
        width: 100%; padding: 12px 12px 12px 40px; border-radius: var(--radius-md);
        border: 1px solid #e2e8f0; background: #f8fafc; font-weight: 600; font-size: 0.9rem;
        transition: all 0.2s;
    }
    .filter-input.no-icon { padding-left: 14px; }
    .filter-input:focus { 
        border-color: var(--primary-green); 
        background: white;
        outline: none; 
        box-shadow: 0 0 0 4px rgba(0, 200, 83, 0.1); 
    }

    .dual-inputs { display: flex; gap: 10px; }

    .btn-success-premium {
        background: var(--primary-green); color: white; border-radius: var(--radius-md); 
        font-weight: 700; border: none; transition: 0.3s;
        display: flex; align-items: center; justify-content: center;
    }
    .btn-success-premium:hover { 
        background: #00b34a;
        transform: translateY(-2px); 
        box-shadow: 0 8px 20px rgba(0, 200, 83, 0.25); 
    }

    .btn-reset {
        background: transparent; color: #64748b; border: 1px solid #e2e8f0;
        border-radius: var(--radius-md); font-weight: 600; font-size: 0.85rem; transition: 0.2s; cursor: pointer;
    }
    .btn-reset:hover { background: #f1f5f9; color: #1e293b; }

    /* 3-Column Listing Grid in 9/12 context */
    .listings-grid-three {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
    }

    @@media (max-width: 1200px) {
        .listings-grid-three { grid-template-columns: repeat(2, 1fr); }
    }
    @@media (max-width: 768px) {
        .listings-grid-three { grid-template-columns: 1fr; }
    }

    .reveal { opacity: 0; transform: translateY(20px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .reveal.active { opacity: 1; transform: translateY(0); }
</style>

<script>
    const container = document.getElementById('rentListings');

    async function loadListings(filterData = {}) {
        container.innerHTML = `
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
        `;

        try {
            let url = '/api/Listings/rent';
            let method = 'GET';
            let body = null;
            let headers = {};

            if (Object.keys(filterData).length > 0) {
                url = '/api/Listings/filter/rent';
                method = 'POST';
                body = JSON.stringify(filterData);
                headers = { 'Content-Type': 'application/json' };
            }

            const response = await fetch(url, { method, headers, body });
            const result = await response.json();

            container.innerHTML = '';

            if (response.ok && result.data && result.data.length > 0) {
                result.data.forEach(item => {
                    const imageUrl = (item.imageUrls && item.imageUrls.length > 0) 
                        ? item.imageUrls[0] 
                        : 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?auto=format&fit=crop&q=80&w=800';

                    const card = document.createElement('div');
                    card.className = 'listing-card premium-shadow reveal';
                    card.innerHTML = `
                        <div class="card-img">
                            <img src="${imageUrl}" alt="${item.model}" loading="lazy" style="width:100%; height:100%; object-fit:cover;">
                            <div class="card-badge">Available</div>
                        </div>
                        <div class="card-body" style="padding: 20px;">
                            <div class="card-meta">
                                <span><i class="fas fa-calendar-alt text-success"></i> ${item.year}</span>
                                <span><i class="fas fa-gas-pump"></i> ${item.engineType === 0 ? 'Petrol' : item.engineType === 1 ? 'Diesel' : item.engineType === 2 ? 'Electric' : 'Hybrid'}</span>
                            </div>
                            <h5 style="margin: 0 0 15px; font-weight: 800; font-size: 1.15rem; color: var(--text-dark);">${item.brandName || ''} ${item.model}</h5>
                            <div class="card-footer">
                                <div class="card-price">$${(item.dailyRate || 0).toLocaleString()} <span>/ day</span></div>
                                <button onclick="window.location.href='/details/${item.id}?type=rent'" class="btn-icon">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
                
                initScrollReveal();
            } else {
                container.innerHTML = '<div class="text-center w-100 py-5"><p class="text-muted">No matching rentals found.</p></div>';
            }
        } catch (err) {
            console.error(err);
        }
    }

    function initScrollReveal() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadListings();
        initScrollReveal();
        
        document.getElementById('filterForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {};
            formData.forEach((value, key) => {
                if (value !== "") {
                    if (!isNaN(value) && value.trim() !== "") {
                        data[key] = parseFloat(value);
                    } else {
                        data[key] = value;
                    }
                }
            });
            loadListings(data);
        });
    });
</script>
